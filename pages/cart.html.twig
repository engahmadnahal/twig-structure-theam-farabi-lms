{% extends '../layouts/base.html.twig' %}

{% block title %}Shopping Cart - {{ config.site.name|default('Farabi Academy') }}{% endblock %}

{% block meta_description %}Shopping Cart - Farabi Academy{% endblock %}

{% block body_class %}min-h-screen bg-gray-50{% endblock %}

{# Override header with back button instead #}
{% block header %}
  <div class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <button onclick="window.history.back()" class="flex items-center gap-2 text-gray-700 hover:text-pistachio transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        <span>&#x0631;&#x062C;&#x0648;&#x0639;</span>
      </button>
    </div>
  </div>
{% endblock %}

{# Override footer with simple footer #}
{% block footer %}
  <footer class="bg-navy text-white py-6 mt-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-gray-300">
        Powered by <span class="font-bold text-pistachio">{{ config.site.name|default('Farabi Academy') }}</span>
      </p>
    </div>
  </footer>
{% endblock %}

{% block floating_buttons %}{% endblock %}

{% block content %}
    <div class="py-8">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-8">&#x0633;&#x0644;&#x0629; &#x0627;&#x0644;&#x062A;&#x0633;&#x0648;&#x0642;</h1>
        
        <div class="flex flex-col lg:flex-row gap-8">
          <!-- Cart Items -->
          <div class="lg:w-2/3">
            <div class="bg-white rounded-2xl shadow-lg p-6">
              <h2 class="text-xl font-bold text-gray-900 mb-6">&#x0627;&#x0644;&#x0643;&#x0648;&#x0631;&#x0633;&#x0627;&#x062A; &#x0627;&#x0644;&#x0645;&#x0636;&#x0627;&#x0641;&#x0629;</h2>
              
              <!-- Cart Items Container -->
              <div id="cartItems" class="space-y-4">
                <!-- Cart items will be dynamically inserted here -->
              </div>

              <!-- Empty Cart Message -->
              <div id="emptyCart" class="hidden text-center py-12">
                <svg class="w-24 h-24 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
                <p class="text-xl text-gray-600 mb-4">&#x0627;&#x0644;&#x0633;&#x0644;&#x0629; &#x0641;&#x0627;&#x0631;&#x063A;&#x0629;</p>
                <a href="courses.html" class="inline-block px-6 py-3 bg-pistachio text-white rounded-full hover:bg-pistachio-dark transition-all">
                  &#x062A;&#x0635;&#x0641;&#x062D; &#x0627;&#x0644;&#x0643;&#x0648;&#x0631;&#x0633;&#x0627;&#x062A;
                </a>
              </div>
            </div>
          </div>

          <!-- Order Summary -->
          <div class="lg:w-1/3">
            <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
              <h2 class="text-xl font-bold text-gray-900 mb-6">&#x0645;&#x0644;&#x062E;&#x0635; &#x0627;&#x0644;&#x0637;&#x0644;&#x0628;</h2>
              
              <!-- Price Breakdown -->
              <div class="space-y-4 mb-6">
                <div class="flex justify-between text-gray-700">
                  <span>&#x0627;&#x0644;&#x0645;&#x062C;&#x0645;&#x0648;&#x0639; &#x0627;&#x0644;&#x0641;&#x0631;&#x0639;&#x064A;</span>
                  <span id="subtotal">$0</span>
                </div>
                
                <!-- Coupon Section -->
                <div class="border-t border-gray-200 pt-4">
                  <label class="block text-sm font-medium text-gray-700 mb-2">&#x0643;&#x0648;&#x062F; &#x0627;&#x0644;&#x062E;&#x0635;&#x0645;</label>
                  <div class="flex gap-2">
                    <input type="text" id="couponCode" placeholder="&#x0623;&#x062F;&#x062E;&#x0644; &#x0627;&#x0644;&#x0643;&#x0648;&#x062F;" class="flex-1 px-4 py-2 rounded-xl border border-gray-300 bg-white text-gray-900 focus:ring-2 focus:ring-pistachio focus:border-transparent transition-all" />
                    <button id="applyCoupon" class="px-6 py-2 bg-pistachio text-white rounded-xl hover:bg-pistachio-dark transition-all">
                      &#x062A;&#x0637;&#x0628;&#x064A;&#x0642;
                    </button>
                  </div>
                  <div id="couponMessage" class="mt-2 text-sm"></div>
                </div>
                
                <div class="flex justify-between text-gray-700" id="discountRow" style="display: none;">
                  <span class="text-pistachio">&#x0627;&#x0644;&#x062E;&#x0635;&#x0645;</span>
                  <span class="text-pistachio" id="discount">-$0</span>
                </div>
                
                <div class="border-t border-gray-200 pt-4">
                  <div class="flex justify-between text-lg font-bold text-gray-900">
                    <span>&#x0627;&#x0644;&#x0645;&#x062C;&#x0645;&#x0648;&#x0639; &#x0627;&#x0644;&#x0643;&#x0644;&#x064A;</span>
                    <span id="total">$0</span>
                  </div>
                </div>
              </div>

              <!-- Payment Methods -->
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-3">&#x0637;&#x0631;&#x064A;&#x0642;&#x0629; &#x0627;&#x0644;&#x062F;&#x0641;&#x0639;</label>
                <div class="space-y-2">
                  <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-pistachio transition-all payment-method">
                    <input type="radio" name="paymentMethod" value="credit-card" class="w-4 h-4 text-pistachio border-gray-300 focus:ring-pistachio" checked>
                    <div class="ml-3 flex-1">
                      <div class="font-medium text-gray-900">&#x0628;&#x0637;&#x0627;&#x0642;&#x0629; &#x0627;&#x0626;&#x062A;&#x0645;&#x0627;&#x0646;&#x064A;&#x0629;</div>
                      <div class="text-sm text-gray-500">Visa, Mastercard, Amex</div>
                    </div>
                    <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                    </svg>
                  </label>
                  
                  <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-pistachio transition-all payment-method">
                    <input type="radio" name="paymentMethod" value="paypal" class="w-4 h-4 text-pistachio border-gray-300 focus:ring-pistachio">
                    <div class="ml-3 flex-1">
                      <div class="font-medium text-gray-900">PayPal</div>
                      <div class="text-sm text-gray-500">&#x0627;&#x0644;&#x062F;&#x0641;&#x0639; &#x0639;&#x0628;&#x0631; PayPal</div>
                    </div>
                    <svg class="w-6 h-6 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.174 1.305 1.06 3.1.927 4.715-.016.192-.03.384-.041.567-.121 1.58-.282 3.642-.895 5.358-1.537 4.48-5.64 7.012-9.555 7.012H9.806a.696.696 0 0 1-.664-.48l-2.066-6.302z"/>
                    </svg>
                  </label>
                  
                  <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-pistachio transition-all payment-method">
                    <input type="radio" name="paymentMethod" value="bank-transfer" class="w-4 h-4 text-pistachio border-gray-300 focus:ring-pistachio">
                    <div class="ml-3 flex-1">
                      <div class="font-medium text-gray-900">&#x062A;&#x062D;&#x0648;&#x064A;&#x0644; &#x0628;&#x0646;&#x0643;&#x064A;</div>
                      <div class="text-sm text-gray-500">&#x062A;&#x062D;&#x0648;&#x064A;&#x0644; &#x0645;&#x0628;&#x0627;&#x0634;&#x0631; &#x0645;&#x0646; &#x0627;&#x0644;&#x0628;&#x0646;&#x0643;</div>
                    </div>
                    <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                    </svg>
                  </label>
                </div>
              </div>

              <!-- Checkout Button -->
              <button id="checkoutBtn" class="w-full py-4 bg-gradient-to-r from-pistachio to-green-600 text-white rounded-xl hover:from-green-600 hover:to-pistachio transition-all hover:shadow-lg transform hover:scale-[1.02] font-semibold text-lg">
                &#x0625;&#x062A;&#x0645;&#x0627;&#x0645; &#x0627;&#x0644;&#x0637;&#x0644;&#x0628;
              </button>
              
              <p class="text-xs text-gray-500 text-center mt-4">
                &#x0628;&#x0627;&#x0644;&#x0636;&#x063A;&#x0637; &#x0639;&#x0644;&#x0649; "&#x0625;&#x062A;&#x0645;&#x0627;&#x0645; &#x0627;&#x0644;&#x0637;&#x0644;&#x0628;"&#x060C; &#x0623;&#x0646;&#x062A; &#x062A;&#x0648;&#x0627;&#x0641;&#x0642; &#x0639;&#x0644;&#x0649; &#x0634;&#x0631;&#x0648;&#x0637; &#x0648;&#x0623;&#x062D;&#x0643;&#x0627;&#x0645; &#x0627;&#x0644;&#x0627;&#x0633;&#x062A;&#x062E;&#x062F;&#x0627;&#x0645;
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
{% endblock %}

{% block scripts %}
  <script>
    // Sample cart data
    let cartItems = [
      { id: 1, title: "Web Development Mastery", price: 299, image: "https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=800&q=80", category: "web-development" },
      { id: 3, title: "Graphic Design Fundamentals", price: 199, image: "https://images.unsplash.com/photo-1626785774573-4b799315345d?w=800&q=80", category: "graphic-design" }
    ];

    let discount = 0;
    let discountPercentage = 0;

    const coupons = { 'WELCOME10': 10, 'STUDENT20': 20, 'SUMMER30': 30 };

    function renderCartItems() {
      const container = document.getElementById('cartItems');
      const emptyCart = document.getElementById('emptyCart');
      
      if (cartItems.length === 0) {
        container.classList.add('hidden');
        emptyCart.classList.remove('hidden');
        updateTotals();
        return;
      }

      container.classList.remove('hidden');
      emptyCart.classList.add('hidden');

      container.innerHTML = cartItems.map(item => `
        <div class="flex gap-4 p-4 border border-gray-200 rounded-xl hover:shadow-md transition-all" data-item-id="${item.id}">
          <img src="${item.image}" alt="${item.title}" class="w-24 h-24 object-cover rounded-lg" loading="lazy" />
          <div class="flex-1">
            <h3 class="font-bold text-gray-900 mb-1">${item.title}</h3>
            <p class="text-sm text-gray-600 mb-2">${item.category.replace('-', ' ')}</p>
            <div class="flex items-center justify-between">
              <span class="text-lg font-bold text-pistachio">$${item.price}</span>
              <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 transition-colors" aria-label="Remove item">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      `).join('');

      updateTotals();
    }

    function updateTotals() {
      const subtotal = cartItems.reduce((sum, item) => sum + item.price, 0);
      const discountAmount = (subtotal * discountPercentage) / 100;
      const total = subtotal - discountAmount;

      document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
      
      if (discountAmount > 0) {
        document.getElementById('discountRow').style.display = 'flex';
        document.getElementById('discount').textContent = `-$${discountAmount.toFixed(2)}`;
      } else {
        document.getElementById('discountRow').style.display = 'none';
      }
      
      document.getElementById('total').textContent = `$${total.toFixed(2)}`;
    }

    function removeFromCart(itemId) {
      cartItems = cartItems.filter(item => item.id !== itemId);
      renderCartItems();
    }

    document.getElementById('applyCoupon').addEventListener('click', () => {
      const code = document.getElementById('couponCode').value.toUpperCase().trim();
      const messageDiv = document.getElementById('couponMessage');
      
      if (coupons[code]) {
        discountPercentage = coupons[code];
        messageDiv.innerHTML = `<span class="text-green-600">\u2713 \u062A\u0645 \u062A\u0637\u0628\u064A\u0642 \u0627\u0644\u062E\u0635\u0645 ${discountPercentage}%</span>`;
        updateTotals();
      } else {
        discountPercentage = 0;
        messageDiv.innerHTML = `<span class="text-red-600">\u0643\u0648\u062F \u062E\u0635\u0645 \u063A\u064A\u0631 \u0635\u062D\u064A\u062D</span>`;
        updateTotals();
      }
    });

    document.querySelectorAll('.payment-method').forEach(label => {
      label.addEventListener('click', () => {
        document.querySelectorAll('.payment-method').forEach(l => {
          l.classList.remove('border-pistachio');
          l.classList.add('border-gray-200');
        });
        label.classList.add('border-pistachio');
        label.classList.remove('border-gray-200');
      });
    });

    document.getElementById('checkoutBtn').addEventListener('click', () => {
      if (cartItems.length === 0) {
        alert('\u0627\u0644\u0633\u0644\u0629 \u0641\u0627\u0631\u063A\u0629');
        return;
      }
      const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
      const total = parseFloat(document.getElementById('total').textContent.replace('$', ''));
      alert(`\u0633\u064A\u062A\u0645 \u062A\u0648\u062C\u064A\u0647\u0643 \u0625\u0644\u0649 \u0635\u0641\u062D\u0629 \u0627\u0644\u062F\u0641\u0639\n\u0637\u0631\u064A\u0642\u0629 \u0627\u0644\u062F\u0641\u0639: ${paymentMethod}\n\u0627\u0644\u0645\u0628\u0644\u063A: $${total.toFixed(2)}`);
    });

    window.addEventListener('DOMContentLoaded', () => {
      renderCartItems();
    });

    window.removeFromCart = removeFromCart;
  </script>
{% endblock %}
